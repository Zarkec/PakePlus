import{s as R}from"./statisticsApi-DMMUHzRw.js";import{i as C}from"./index-u3wYLQ4o.js";import{d as V,r as A,a as z,p as I,q as N,b as M,e as t,s as w,f as o,g as h,v as F,w as a,t as y,x,i as O,m as T,o as f}from"./index-CCQ4VAXS.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"monthly-report-container"},U={class:"page-header"},q={class:"date-selector"},G={class:"stats-overview"},j={class:"card-content"},H={class:"data-value primary"},J={class:"card-content"},K={class:"data-value success"},Q={class:"card-content"},X={class:"data-value warning"},Z={class:"card-content"},$={class:"data-value danger"},ee={class:"charts-section"},te={class:"data-table-section"},ae={class:"card-header"},oe={class:"data-cell"},se={class:"data-cell success"},le={class:"data-cell warning"},re={class:"data-cell danger"},ne=V({__name:"MonthlyReport",setup(ie){const g=A(""),s=z({summary:{year:0,month:0,total:0,ok_count:0,ng_count:0,ng_rate:0},daily_data:[],error_types:[]}),i=z({summary:!0,daily:!0,errorTypes:!0});let d=null,c=null;const S=async()=>{i.summary=!0,i.daily=!0,i.errorTypes=!0;try{let l={};if(g.value){const[r,n]=g.value.split("-").map(Number);l={year:r,month:n}}const e=await R.getMonthlyReport(l);s.summary=e.summary,s.daily_data=e.daily_data,s.error_types=e.error_types,L(),D()}catch(l){console.error("获取月度报表数据失败:",l),T.error("获取月度报表数据失败")}finally{i.summary=!1,i.daily=!1,i.errorTypes=!1}},E=()=>{S()},L=()=>{const l=document.getElementById("daily-chart");l&&(d&&d.dispose(),setTimeout(()=>{d=C(l);const e=s.daily_data.map(p=>p.day),r=s.daily_data.map(p=>p.total),n=s.daily_data.map(p=>p.ok_count),m=s.daily_data.map(p=>p.ng_count),v={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["检测总数","正常数量","异常数量"],top:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e,axisLine:{lineStyle:{color:"#ddd"}},axisLabel:{color:"#666",fontSize:12,margin:12}},yAxis:{type:"value",splitLine:{lineStyle:{color:"#eee"}},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#666",fontSize:12}},series:[{name:"检测总数",type:"line",stack:"Total",smooth:!0,symbol:"circle",symbolSize:6,sampling:"average",data:r,itemStyle:{color:"#409EFF"},lineStyle:{width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.2)"},{offset:1,color:"rgba(64, 158, 255, 0.01)"}]}}},{name:"正常数量",type:"line",stack:"Total",smooth:!0,symbol:"circle",symbolSize:6,sampling:"average",data:n,itemStyle:{color:"#67C23A"},lineStyle:{width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(103, 194, 58, 0.2)"},{offset:1,color:"rgba(103, 194, 58, 0.01)"}]}}},{name:"异常数量",type:"line",stack:"Total",smooth:!0,symbol:"circle",symbolSize:6,sampling:"average",data:m,itemStyle:{color:"#F56C6C"},lineStyle:{width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(245, 108, 108, 0.2)"},{offset:1,color:"rgba(245, 108, 108, 0.01)"}]}}}]};d.setOption(v),d.resize()},100))},D=()=>{if(!s.error_types.length)return;const l=document.getElementById("error-pie-chart");l&&(c&&c.dispose(),setTimeout(()=>{c=C(l);const e={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:s.error_types.map(r=>r.name)},series:[{name:"异常类型",type:"pie",radius:["45%","75%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:s.error_types.map(r=>({value:r.value,name:r.name,itemStyle:{color:r.color}}))}]};c.setOption(e),c.resize()},100))},Y=()=>{T.success("Excel导出功能将在后续版本中实现")},k=()=>{d&&d.resize(),c&&c.resize()};return I(()=>{S(),window.addEventListener("resize",k)}),N(()=>{window.removeEventListener("resize",k),d&&(d.dispose(),d=null),c&&(c.dispose(),c=null)}),(l,e)=>{const r=h("el-date-picker"),n=h("el-card"),m=h("el-col"),v=h("el-row"),p=h("el-button"),_=h("el-table-column"),B=h("el-table"),b=F("loading");return f(),M("div",P,[t("div",U,[e[1]||(e[1]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"月度报表"),t("p",{class:"page-description"},"查看月度检测数据统计和趋势分析")],-1)),t("div",q,[o(r,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=u=>g.value=u),type:"month",placeholder:"选择月份",format:"YYYY年MM月","value-format":"YYYY-MM",clearable:!1,onChange:E},null,8,["modelValue"])])]),w((f(),M("div",G,[o(v,{gutter:20},{default:a(()=>[o(m,{span:6},{default:a(()=>[o(n,{shadow:"hover",class:"data-card"},{header:a(()=>e[2]||(e[2]=[t("div",{class:"card-header"},[t("h3",null,"月度检测总数")],-1)])),default:a(()=>[t("div",j,[t("div",H,y(s.summary.total),1),e[3]||(e[3]=t("div",{class:"data-label"},"次",-1))])]),_:1})]),_:1}),o(m,{span:6},{default:a(()=>[o(n,{shadow:"hover",class:"data-card"},{header:a(()=>e[4]||(e[4]=[t("div",{class:"card-header"},[t("h3",null,"正常数量")],-1)])),default:a(()=>[t("div",J,[t("div",K,y(s.summary.ok_count),1),e[5]||(e[5]=t("div",{class:"data-label"},"次",-1))])]),_:1})]),_:1}),o(m,{span:6},{default:a(()=>[o(n,{shadow:"hover",class:"data-card"},{header:a(()=>e[6]||(e[6]=[t("div",{class:"card-header"},[t("h3",null,"异常数量")],-1)])),default:a(()=>[t("div",Q,[t("div",X,y(s.summary.ng_count),1),e[7]||(e[7]=t("div",{class:"data-label"},"次",-1))])]),_:1})]),_:1}),o(m,{span:6},{default:a(()=>[o(n,{shadow:"hover",class:"data-card"},{header:a(()=>e[8]||(e[8]=[t("div",{class:"card-header"},[t("h3",null,"月度异常率")],-1)])),default:a(()=>[t("div",Z,[t("div",$,y(s.summary.ng_rate),1),e[9]||(e[9]=t("div",{class:"data-label"},"%",-1))])]),_:1})]),_:1})]),_:1})])),[[b,i.summary]]),t("div",ee,[o(v,{gutter:20},{default:a(()=>[o(m,{span:16},{default:a(()=>[w((f(),x(n,{shadow:"hover",class:"chart-card"},{header:a(()=>e[10]||(e[10]=[t("div",{class:"card-header"},[t("h3",null,"日检测趋势")],-1)])),default:a(()=>[e[11]||(e[11]=t("div",{id:"daily-chart",class:"chart-container"},null,-1))]),_:1})),[[b,i.daily]])]),_:1}),o(m,{span:8},{default:a(()=>[w((f(),x(n,{shadow:"hover",class:"chart-card pie-chart-card"},{header:a(()=>e[12]||(e[12]=[t("div",{class:"card-header"},[t("h3",null,"月度异常类型分布")],-1)])),default:a(()=>[e[13]||(e[13]=t("div",{id:"error-pie-chart",class:"chart-container pie-container"},null,-1))]),_:1})),[[b,i.errorTypes]])]),_:1})]),_:1})]),t("div",te,[w((f(),x(n,{shadow:"hover",class:"table-card"},{header:a(()=>[t("div",ae,[e[15]||(e[15]=t("h3",null,"日检测数据明细",-1)),o(p,{type:"primary",size:"small",onClick:Y},{default:a(()=>e[14]||(e[14]=[O(" 导出Excel ")])),_:1})])]),default:a(()=>[o(B,{data:s.daily_data,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{padding:"12px 0"},"highlight-current-row":""},{default:a(()=>[o(_,{prop:"date",label:"日期","min-width":"120",align:"center"}),o(_,{prop:"total",label:"检测总数","min-width":"120",align:"right"},{default:a(u=>[t("span",oe,y(u.row.total),1)]),_:1}),o(_,{prop:"ok_count",label:"正常数量","min-width":"120",align:"right"},{default:a(u=>[t("span",se,y(u.row.ok_count),1)]),_:1}),o(_,{prop:"ng_count",label:"异常数量","min-width":"120",align:"right"},{default:a(u=>[t("span",le,y(u.row.ng_count),1)]),_:1}),o(_,{prop:"ng_rate",label:"异常率","min-width":"120",align:"right"},{default:a(u=>[t("span",re,y(u.row.ng_rate)+"%",1)]),_:1})]),_:1},8,["data"])]),_:1})),[[b,i.daily]])])])}}}),me=W(ne,[["__scopeId","data-v-1a130d10"]]);export{me as default};
