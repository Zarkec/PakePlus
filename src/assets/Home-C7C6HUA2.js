import{n as L,d as J,r as v,c as g,p as K,q as Q,b as X,e as t,f as s,w as a,g as w,s as x,v as Y,x as T,t as p,i as n,y as Z,o as m}from"./index-CCQ4VAXS.js";import{i as R}from"./index-u3wYLQ4o.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B={getStats(f={}){return L.get("/v1/dashboard/stats",{params:f})},getTrend(f={}){return L.get("/v1/dashboard/trend",{params:f})},getErrorTypes(f={}){return L.get("/v1/dashboard/error-types",{params:f})}},ee={class:"home-container"},te={class:"dashboard"},ae={class:"card-content"},se={class:"data-value success"},oe={class:"card-footer"},le={class:"card-content"},re={class:"data-value warning"},ne={class:"card-footer"},de={class:"card-header"},ie={class:"week-type-selector"},ue={class:"weekly-stats"},ce={class:"stat-item"},ve={class:"stat-value"},pe={class:"stat-item"},fe={class:"stat-value"},_e={class:"stat-item"},me={class:"stat-value"},ye={class:"system-info"},he={class:"card-header"},be={class:"chart-controls"},ge={class:"card-header"},we={class:"chart-controls"},xe=J({__name:"Home",setup(f){const r=v({today_errors:0,today_total:0,yesterday_total:0,week_total:0,current_week_errors:0}),y=v({labels:[],datasets:[]}),k=v([]),d=v({stats:!0,trend:!0,errorTypes:!0}),C=v("7d"),S=v("7d"),z=v("calendar"),U=g(()=>r.value.today_total===0?"0.00":(r.value.today_errors/r.value.today_total*100).toFixed(2)),N=g(()=>r.value.week_total===0?"0.00":(r.value.current_week_errors/r.value.week_total*100).toFixed(2)),D=g(()=>r.value.yesterday_total===0?"0":((r.value.today_total-r.value.yesterday_total)/r.value.yesterday_total*100).toFixed(1)),O=g(()=>Math.abs(parseFloat(D.value)).toFixed(1)),W=g(()=>parseFloat(D.value)>=0?"el-icon-top":"el-icon-bottom"),F=async()=>{d.value.stats=!0;try{const o=await B.getStats({week_type:z.value});r.value=o}catch(o){console.error("获取统计数据失败:",o)}finally{d.value.stats=!1}},H=()=>{F()},I=async()=>{d.value.trend=!0;try{const o=await B.getTrend({period:C.value,type:"both"});y.value=o,G()}catch(o){console.error("获取趋势数据失败:",o)}finally{d.value.trend=!1}},M=()=>{I()},q=()=>{P()},P=async()=>{d.value.errorTypes=!0;try{const o=await B.getErrorTypes({period:S.value});k.value=o,j()}catch(o){console.error("获取错误类型分布数据失败:",o)}finally{d.value.errorTypes=!1}};let i=null;const G=()=>{if(!y.value.labels.length)return;const o=document.getElementById("trend-chart");o&&(i&&i.dispose(),setTimeout(()=>{i=R(o);const e={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:y.value.datasets.map(l=>l.label),top:10},grid:{left:"3%",right:"4%",bottom:"8%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:y.value.labels,axisLine:{lineStyle:{color:"#ddd"}},axisLabel:{color:"#666",fontSize:12,margin:12}},yAxis:{type:"value",splitLine:{lineStyle:{color:"#eee"}},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#666",fontSize:12}},series:y.value.datasets.map(l=>({name:l.label,type:"line",stack:"Total",smooth:!0,symbol:"circle",symbolSize:6,sampling:"average",data:l.data,itemStyle:{color:l.borderColor},lineStyle:{width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:l.label==="总检测数"?"rgba(76, 175, 80, 0.2)":"rgba(244, 67, 54, 0.2)"},{offset:1,color:l.label==="总检测数"?"rgba(76, 175, 80, 0.01)":"rgba(244, 67, 54, 0.01)"}]}}}))};i.setOption(e),i.resize()},100))};let u=null;const j=()=>{if(!k.value.length)return;const o=document.getElementById("error-pie-chart");o&&(u&&u.dispose(),setTimeout(()=>{u=R(o);const e={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:k.value.map(l=>l.name)},series:[{name:"异常类型",type:"pie",radius:["45%","75%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:k.value.map(l=>({value:l.value,name:l.name,itemStyle:{color:l.color}}))}]};u.setOption(e),u.resize()},100))},A=()=>{i&&i.resize(),u&&u.resize()};return K(()=>{F(),I(),P(),window.addEventListener("resize",A)}),Q(()=>{window.removeEventListener("resize",A),i&&(i.dispose(),i=null),u&&(u.dispose(),u=null)}),(o,e)=>{const l=w("el-card"),_=w("el-col"),c=w("el-radio-button"),V=w("el-radio-group"),E=w("el-row"),h=Y("loading");return m(),X("div",ee,[e[24]||(e[24]=t("div",{class:"welcome-section"},[t("h1",{class:"welcome-title"},"欢迎使用昌瑞视觉检测管理系统"),t("div",{class:"welcome-subtitle"},"智能检测 · 高效管理 · 精准分析")],-1)),t("div",te,[s(E,{gutter:20},{default:a(()=>[s(_,{span:8},{default:a(()=>[x((m(),T(l,{shadow:"hover",class:"data-card"},{header:a(()=>e[3]||(e[3]=[t("div",{class:"card-header"},[t("h3",null,[t("i",{class:"el-icon-data-line"}),n(" 今日检测总数")])],-1)])),default:a(()=>[t("div",ae,[t("div",se,p(r.value.today_total),1),e[4]||(e[4]=t("div",{class:"data-label"},"次",-1))]),t("div",oe,[t("span",null,[e[5]||(e[5]=n("较昨日 ")),t("i",{class:Z(W.value)},null,2),n(" "+p(O.value)+"%",1)])])]),_:1})),[[h,d.value.stats]])]),_:1}),s(_,{span:8},{default:a(()=>[x((m(),T(l,{shadow:"hover",class:"data-card"},{header:a(()=>e[6]||(e[6]=[t("div",{class:"card-header"},[t("h3",null,[t("i",{class:"el-icon-warning"}),n(" 异常检测数")])],-1)])),default:a(()=>[t("div",le,[t("div",re,p(r.value.today_errors),1),e[7]||(e[7]=t("div",{class:"data-label"},"次",-1))]),t("div",ne,[t("span",null,"异常率 "+p(U.value)+"%",1)])]),_:1})),[[h,d.value.stats]])]),_:1}),s(_,{span:8},{default:a(()=>[x((m(),T(l,{shadow:"hover",class:"data-card"},{header:a(()=>[t("div",de,[e[10]||(e[10]=t("h3",null,"本周统计",-1)),t("div",ie,[s(V,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=b=>z.value=b),size:"small",onChange:H},{default:a(()=>[s(c,{label:"calendar"},{default:a(()=>e[8]||(e[8]=[n("日历周")])),_:1}),s(c,{label:"rolling"},{default:a(()=>e[9]||(e[9]=[n("过去7天")])),_:1})]),_:1},8,["modelValue"])])])]),default:a(()=>[t("div",ue,[t("div",ce,[e[11]||(e[11]=t("div",{class:"stat-label"},"本周检测总数",-1)),t("div",ve,p(r.value.week_total),1)]),t("div",pe,[e[12]||(e[12]=t("div",{class:"stat-label"},"本周异常数",-1)),t("div",fe,p(r.value.current_week_errors),1)]),t("div",_e,[e[13]||(e[13]=t("div",{class:"stat-label"},"本周异常率",-1)),t("div",me,p(N.value)+"%",1)])])]),_:1})),[[h,d.value.stats]])]),_:1})]),_:1})]),t("div",ye,[s(E,{gutter:20},{default:a(()=>[s(_,{span:12},{default:a(()=>[x((m(),T(l,{shadow:"hover",class:"chart-card"},{header:a(()=>[t("div",he,[e[17]||(e[17]=t("h3",null,"检测数据趋势",-1)),t("div",be,[s(V,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=b=>C.value=b),size:"small",onChange:M},{default:a(()=>[s(c,{label:"24h"},{default:a(()=>e[14]||(e[14]=[n("24小时")])),_:1}),s(c,{label:"7d"},{default:a(()=>e[15]||(e[15]=[n("7天")])),_:1}),s(c,{label:"30d"},{default:a(()=>e[16]||(e[16]=[n("30天")])),_:1})]),_:1},8,["modelValue"])])])]),default:a(()=>[e[18]||(e[18]=t("div",{id:"trend-chart",class:"chart-container"},null,-1))]),_:1})),[[h,d.value.trend]])]),_:1}),s(_,{span:12},{default:a(()=>[x((m(),T(l,{shadow:"hover",class:"chart-card pie-chart-card"},{header:a(()=>[t("div",ge,[e[22]||(e[22]=t("h3",null,"异常类型分布",-1)),t("div",we,[s(V,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=b=>S.value=b),size:"small",onChange:q},{default:a(()=>[s(c,{label:"24h"},{default:a(()=>e[19]||(e[19]=[n("24小时")])),_:1}),s(c,{label:"7d"},{default:a(()=>e[20]||(e[20]=[n("7天")])),_:1}),s(c,{label:"30d"},{default:a(()=>e[21]||(e[21]=[n("30天")])),_:1})]),_:1},8,["modelValue"])])])]),default:a(()=>[e[23]||(e[23]=t("div",{id:"error-pie-chart",class:"chart-container pie-container"},null,-1))]),_:1})),[[h,d.value.errorTypes]])]),_:1})]),_:1}),s(E,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[s(_,{span:24})]),_:1})])])}}}),Se=$(xe,[["__scopeId","data-v-556548c2"]]);export{Se as default};
