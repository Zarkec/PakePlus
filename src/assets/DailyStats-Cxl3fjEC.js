import{s as V}from"./statisticsApi-DMMUHzRw.js";import{i as S}from"./index-u3wYLQ4o.js";import{d as A,r as I,a as k,p as F,q as N,b as z,e as t,s as w,f as s,g as m,v as O,w as a,t as c,x,i as W,m as E,o as f}from"./index-CCQ4VAXS.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"daily-stats-container"},U={class:"page-header"},q={class:"date-selector"},H={class:"stats-overview"},$={class:"card-content"},j={class:"data-value primary"},G={class:"card-content"},J={class:"data-value success"},K={class:"card-content"},Q={class:"data-value warning"},X={class:"card-content"},Z={class:"data-value danger"},ee={class:"charts-section"},te={class:"data-table-section"},ae={class:"card-header"},se={class:"data-cell"},oe={class:"data-cell"},re={class:"data-cell success"},le={class:"data-cell warning"},ne={class:"data-cell danger"},de=A({__name:"DailyStats",setup(ie){const v=I(""),o=k({summary:{date:"",total:0,ok_count:0,ng_count:0,ng_rate:0},hourly_data:[],error_types:[]}),l=k({summary:!0,hourly:!0,errorTypes:!0});let n=null,d=null;const D=async()=>{l.summary=!0,l.hourly=!0,l.errorTypes=!0;try{const i=v.value?{date:v.value}:{},e=await V.getDailyStatistics(i);o.summary=e.summary,o.hourly_data=e.hourly_data,o.error_types=e.error_types,T(),Y()}catch(i){console.error("获取日检测统计数据失败:",i),E.error("获取日检测统计数据失败")}finally{l.summary=!1,l.hourly=!1,l.errorTypes=!1}},L=()=>{D()},T=()=>{const i=document.getElementById("hourly-chart");i&&(n&&n.dispose(),setTimeout(()=>{n=S(i);const e=o.hourly_data.map(h=>`${h.hour}:00`),u=o.hourly_data.map(h=>h.total),p=o.hourly_data.map(h=>h.ok_count),_=o.hourly_data.map(h=>h.ng_count),g={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["检测总数","正常数量","异常数量"],top:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:e,axisLine:{lineStyle:{color:"#ddd"}},axisLabel:{color:"#666",fontSize:12,margin:12}},yAxis:{type:"value",splitLine:{lineStyle:{color:"#eee"}},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#666",fontSize:12}},series:[{name:"检测总数",type:"bar",data:u,itemStyle:{color:"#409EFF"}},{name:"正常数量",type:"bar",data:p,itemStyle:{color:"#67C23A"}},{name:"异常数量",type:"bar",data:_,itemStyle:{color:"#F56C6C"}}]};n.setOption(g),n.resize()},100))},Y=()=>{if(!o.error_types.length)return;const i=document.getElementById("error-pie-chart");i&&(d&&d.dispose(),setTimeout(()=>{d=S(i);const e={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:o.error_types.map(u=>u.name)},series:[{name:"异常类型",type:"pie",radius:["45%","75%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:o.error_types.map(u=>({value:u.value,name:u.name,itemStyle:{color:u.color}}))}]};d.setOption(e),d.resize()},100))},B=()=>{E.success("Excel导出功能将在后续版本中实现")},C=()=>{n&&n.resize(),d&&d.resize()};return F(()=>{D(),window.addEventListener("resize",C)}),N(()=>{window.removeEventListener("resize",C),n&&(n.dispose(),n=null),d&&(d.dispose(),d=null)}),(i,e)=>{const u=m("el-date-picker"),p=m("el-card"),_=m("el-col"),g=m("el-row"),h=m("el-button"),y=m("el-table-column"),M=m("el-table"),b=O("loading");return f(),z("div",R,[t("div",U,[e[1]||(e[1]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"日检测统计"),t("p",{class:"page-description"},"查看每日检测数据统计和异常分析")],-1)),t("div",q,[s(u,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=r=>v.value=r),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:!1,onChange:L},null,8,["modelValue"])])]),w((f(),z("div",H,[s(g,{gutter:20},{default:a(()=>[s(_,{span:6},{default:a(()=>[s(p,{shadow:"hover",class:"data-card"},{header:a(()=>e[2]||(e[2]=[t("div",{class:"card-header"},[t("h3",null,"检测总数")],-1)])),default:a(()=>[t("div",$,[t("div",j,c(o.summary.total),1),e[3]||(e[3]=t("div",{class:"data-label"},"次",-1))])]),_:1})]),_:1}),s(_,{span:6},{default:a(()=>[s(p,{shadow:"hover",class:"data-card"},{header:a(()=>e[4]||(e[4]=[t("div",{class:"card-header"},[t("h3",null,"正常数量")],-1)])),default:a(()=>[t("div",G,[t("div",J,c(o.summary.ok_count),1),e[5]||(e[5]=t("div",{class:"data-label"},"次",-1))])]),_:1})]),_:1}),s(_,{span:6},{default:a(()=>[s(p,{shadow:"hover",class:"data-card"},{header:a(()=>e[6]||(e[6]=[t("div",{class:"card-header"},[t("h3",null,"异常数量")],-1)])),default:a(()=>[t("div",K,[t("div",Q,c(o.summary.ng_count),1),e[7]||(e[7]=t("div",{class:"data-label"},"次",-1))])]),_:1})]),_:1}),s(_,{span:6},{default:a(()=>[s(p,{shadow:"hover",class:"data-card"},{header:a(()=>e[8]||(e[8]=[t("div",{class:"card-header"},[t("h3",null,"异常率")],-1)])),default:a(()=>[t("div",X,[t("div",Z,c(o.summary.ng_rate),1),e[9]||(e[9]=t("div",{class:"data-label"},"%",-1))])]),_:1})]),_:1})]),_:1})])),[[b,l.summary]]),t("div",ee,[s(g,{gutter:20},{default:a(()=>[s(_,{span:16},{default:a(()=>[w((f(),x(p,{shadow:"hover",class:"chart-card"},{header:a(()=>e[10]||(e[10]=[t("div",{class:"card-header"},[t("h3",null,"小时检测趋势")],-1)])),default:a(()=>[e[11]||(e[11]=t("div",{id:"hourly-chart",class:"chart-container"},null,-1))]),_:1})),[[b,l.hourly]])]),_:1}),s(_,{span:8},{default:a(()=>[w((f(),x(p,{shadow:"hover",class:"chart-card pie-chart-card"},{header:a(()=>e[12]||(e[12]=[t("div",{class:"card-header"},[t("h3",null,"异常类型分布")],-1)])),default:a(()=>[e[13]||(e[13]=t("div",{id:"error-pie-chart",class:"chart-container pie-container"},null,-1))]),_:1})),[[b,l.errorTypes]])]),_:1})]),_:1})]),t("div",te,[w((f(),x(p,{shadow:"hover",class:"table-card"},{header:a(()=>[t("div",ae,[e[15]||(e[15]=t("h3",null,"小时检测数据明细",-1)),s(h,{type:"primary",size:"small",onClick:B},{default:a(()=>e[14]||(e[14]=[W(" 导出Excel ")])),_:1})])]),default:a(()=>[s(M,{data:o.hourly_data,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{padding:"12px 0"},"highlight-current-row":""},{default:a(()=>[s(y,{prop:"hour",label:"小时","min-width":"100",align:"center"},{default:a(r=>[t("span",se,c(r.row.hour)+":00 - "+c(r.row.hour)+":59",1)]),_:1}),s(y,{prop:"total",label:"检测总数","min-width":"120",align:"right"},{default:a(r=>[t("span",oe,c(r.row.total),1)]),_:1}),s(y,{prop:"ok_count",label:"正常数量","min-width":"120",align:"right"},{default:a(r=>[t("span",re,c(r.row.ok_count),1)]),_:1}),s(y,{prop:"ng_count",label:"异常数量","min-width":"120",align:"right"},{default:a(r=>[t("span",le,c(r.row.ng_count),1)]),_:1}),s(y,{prop:"ng_rate",label:"异常率","min-width":"120",align:"right"},{default:a(r=>[t("span",ne,c(r.row.ng_rate)+"%",1)]),_:1})]),_:1},8,["data"])]),_:1})),[[b,l.hourly]])])])}}}),_e=P(de,[["__scopeId","data-v-235acf0d"]]);export{_e as default};
