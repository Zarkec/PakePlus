import{d as ye,r as c,a as be,p as he,b as _,e as s,f as t,w as a,i as m,g as f,u as M,z as we,F as T,B as ee,M as ke,D as De,s as j,v as Ve,x as q,t as v,R as Ce,S as Ie,G as $,m as D,o as g}from"./index-CCQ4VAXS.js";import{r as z}from"./resultApi-ChXHL17r.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"result-management-container"},Re={class:"content-card"},xe={class:"card-header"},Se={class:"action-bar"},Le={class:"filter-bar"},$e={class:"filter-group"},Ee={class:"filter-group"},Fe={class:"filter-group"},Ue={class:"filter-group"},Ye={class:"filter-buttons"},Be={class:"table-container"},Ne={class:"data-cell id-cell"},Pe={class:"data-cell device-cell"},Ae={class:"data-cell time-cell"},Oe={class:"tag-wrapper"},Te={class:"tag-content"},je={class:"tag-text"},qe={class:"data-cell product-cell"},Ge={class:"data-cell product-id-cell"},We={class:"data-cell system-cell"},He={class:"button-group-horizontal"},Je={class:"pagination"},Ke={key:0,class:"detail-section"},Qe={key:1,class:"detail-section"},Xe={class:"dialog-footer"},Ze={key:0,class:"image-grid"},et={class:"image-card"},tt={class:"image-container"},lt={class:"image-path-overlay"},at={class:"image-info"},st={class:"image-time"},ot={class:"dialog-footer"},nt={key:0,class:"single-image-container"},rt={class:"image-path-overlay"},it={class:"dialog-footer"},dt=ye({__name:"ResultManagement",setup(ut){const G=c([]),E=c(!1),R=c("custom"),o=be({date:[],result:"",device:"",product:"",productId:""}),te=n=>{const e=new Date,r=i=>{const d=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),I=String(i.getDate()).padStart(2,"0");return`${d}-${y}-${I}`};switch(n){case"custom":break;case"today":o.date=[r(e),r(e)];break;case"yesterday":const i=new Date(e);i.setDate(e.getDate()-1),o.date=[r(i),r(i)];break;case"last7days":const d=new Date(e);d.setDate(e.getDate()-6),o.date=[r(d),r(e)];break;case"last30days":const y=new Date(e);y.setDate(e.getDate()-29),o.date=[r(y),r(e)];break;case"thisMonth":const I=new Date(e.getFullYear(),e.getMonth(),1);o.date=[r(I),r(e)];break;case"lastMonth":const N=new Date(e.getFullYear(),e.getMonth()-1,1),u=new Date(e.getFullYear(),e.getMonth(),0);o.date=[r(N),r(u)];break}},le=async()=>{E.value=!0;try{const n=await z.getProductList();G.value=n}catch(n){console.error("获取产品列表失败:",n),D.error("获取产品列表失败")}finally{E.value=!1}},W=c([]),x=c(!1),H=c(0),w=c(1),F=c(10),ae=({row:n})=>n.ok===0?"fail-row":"",k=async()=>{x.value=!0;try{const n=o.date&&o.date.length>0?o.date[0]:void 0,e=o.date&&o.date.length>1?o.date[1]:void 0,r={page:w.value,page_size:F.value};n&&(r.start_date=n),e&&(r.end_date=e),o.result&&(r.ok=o.result==="pass"?1:0),o.device&&(r.hostname=o.device),o.product&&(r.product=o.product),o.productId&&(r.product_id=o.productId);const i=await z.getResultList(r);W.value=i.items,H.value=i.total}catch(n){console.error("获取检测结果列表失败:",n),D.error("获取检测结果列表失败")}finally{x.value=!1}},se=n=>{w.value=n,k()},oe=n=>{F.value=n,w.value=1,k()},ne=()=>{w.value=1,k()},re=()=>{R.value="custom",o.date=[],o.result="",o.device="",o.product="",o.productId="",w.value=1,k()},ie=()=>{k()},V=c(!1),p=c(null),U=c(!1),de=async n=>{U.value=!0,V.value=!0;try{const e=await z.getResultDetail(n);p.value=e}catch(e){console.error("获取检测结果详情失败:",e),D.error("获取检测结果详情失败"),V.value=!1}finally{U.value=!1}},C=c(!1),Y=c([]),B=c(!1),ue=c(null),ce=async n=>{B.value=!0,C.value=!0,ue.value=n;try{const e=await z.getResultImages(n);Y.value=e.items}catch(e){console.error("获取检测结果图片失败:",e),D.error("获取检测结果图片失败"),C.value=!1}finally{B.value=!1}},S=c(!1),h=c(null),pe=n=>{h.value=n,S.value=!0},me=c([]),ve=async()=>{try{const n=await z.getResultList({page:1,page_size:3});me.value=n.items.filter(e=>e.ok===0)}catch(n){console.error("获取最近不合格项失败:",n)}},J=(n,e)=>{const r=n.target;r.style.display="none";const i=r.parentElement;if(i&&!i.querySelector(".image-path-display")){const d=document.createElement("div");d.className="image-path-display",d.textContent=e.filename,i.insertBefore(d,i.firstChild)}console.error("图片加载失败:",e.filename)},K=n=>{navigator.clipboard.writeText(n).then(()=>{D.success("文件路径已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e),D.error("复制失败")})};return he(()=>{le(),k(),ve()}),(n,e)=>{const r=f("el-icon"),i=f("el-button"),d=f("el-option"),y=f("el-select"),I=f("el-date-picker"),N=f("el-input"),u=f("el-table-column"),Q=f("el-tag"),P=f("el-table"),fe=f("el-pagination"),b=f("el-descriptions-item"),ge=f("el-descriptions"),A=f("el-dialog"),X=f("el-image"),_e=f("el-empty"),O=Ve("loading");return g(),_("div",ze,[e[31]||(e[31]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",{class:"page-title"},"检测结果管理"),s("div",{class:"page-description"},"查看和管理所有视觉检测设备的检测结果数据")])],-1)),s("div",Re,[s("div",xe,[e[14]||(e[14]=s("div",{class:"card-title"},"检测结果列表",-1)),s("div",Se,[t(i,{type:"primary",class:"primary-button",onClick:ie,loading:x.value},{default:a(()=>[t(r,null,{default:a(()=>[t(M(we))]),_:1}),e[13]||(e[13]=m("刷新数据 "))]),_:1},8,["loading"])])]),s("div",Le,[s("div",$e,[e[15]||(e[15]=s("span",{class:"filter-label"},"检测日期：",-1)),t(y,{modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=l=>R.value=l),placeholder:"选择时间范围",class:"date-range-select",onChange:te},{default:a(()=>[t(d,{label:"自定义",value:"custom"}),t(d,{label:"今天",value:"today"}),t(d,{label:"昨天",value:"yesterday"}),t(d,{label:"最近7天",value:"last7days"}),t(d,{label:"最近30天",value:"last30days"}),t(d,{label:"本月",value:"thisMonth"}),t(d,{label:"上月",value:"lastMonth"})]),_:1},8,["modelValue"]),t(I,{modelValue:o.date,"onUpdate:modelValue":e[1]||(e[1]=l=>o.date=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"date-picker","value-format":"YYYY-MM-DD",disabled:R.value!=="custom"},null,8,["modelValue","disabled"])]),s("div",Ee,[e[16]||(e[16]=s("span",{class:"filter-label"},"检测结果：",-1)),t(y,{modelValue:o.result,"onUpdate:modelValue":e[2]||(e[2]=l=>o.result=l),placeholder:"请选择",class:"filter-select"},{default:a(()=>[t(d,{label:"全部",value:""}),t(d,{label:"合格",value:"pass"}),t(d,{label:"不合格",value:"fail"})]),_:1},8,["modelValue"])]),s("div",Fe,[e[17]||(e[17]=s("span",{class:"filter-label"},"产品名称：",-1)),t(y,{modelValue:o.product,"onUpdate:modelValue":e[3]||(e[3]=l=>o.product=l),placeholder:"请选择",class:"filter-select",loading:E.value},{default:a(()=>[t(d,{label:"全部",value:""}),(g(!0),_(T,null,ee(G.value,l=>(g(),q(d,{key:l.product,label:l.product,value:l.product},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),s("div",Ue,[e[18]||(e[18]=s("span",{class:"filter-label"},"产品ID：",-1)),t(N,{modelValue:o.productId,"onUpdate:modelValue":e[4]||(e[4]=l=>o.productId=l),placeholder:"请输入产品ID",clearable:"",class:"filter-input"},null,8,["modelValue"])]),s("div",Ye,[t(i,{type:"primary",class:"primary-button",onClick:ne},{default:a(()=>[t(r,null,{default:a(()=>[t(M(ke))]),_:1}),e[19]||(e[19]=m("查询 "))]),_:1}),t(i,{onClick:re},{default:a(()=>[t(r,null,{default:a(()=>[t(M(De))]),_:1}),e[20]||(e[20]=m("重置 "))]),_:1})])]),s("div",Be,[j((g(),q(P,{data:W.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{padding:"12px 0"},"row-class-name":ae,"highlight-current-row":"",class:"result-table"},{default:a(()=>[t(u,{prop:"id",label:"ID","min-width":"80",align:"center"},{default:a(l=>[s("span",Ne,v(l.row.id),1)]),_:1}),t(u,{prop:"hostname",label:"设备名称","min-width":"150",align:"center"},{default:a(l=>[s("span",Pe,v(l.row.hostname),1)]),_:1}),t(u,{prop:"create_time",label:"检测时间","min-width":"180",align:"center"},{default:a(l=>[s("span",Ae,v(l.row.create_time),1)]),_:1}),t(u,{prop:"ok",label:"检测结果","min-width":"100",align:"center"},{default:a(l=>[s("div",Oe,[t(Q,{type:l.row.ok===1?"success":"danger",effect:"light",class:"custom-tag"},{default:a(()=>[s("div",Te,[s("span",je,v(l.row.ok===1?"合格":"不合格"),1)])]),_:2},1032,["type"])])]),_:1}),t(u,{prop:"product",label:"产品","min-width":"120",align:"center"},{default:a(l=>[s("span",qe,v(l.row.product),1)]),_:1}),t(u,{prop:"product_id",label:"产品ID","min-width":"120",align:"center"},{default:a(l=>[s("span",Ge,v(l.row.product_id),1)]),_:1}),t(u,{prop:"system",label:"系统","min-width":"100",align:"center"},{default:a(l=>[s("span",We,v(l.row.system),1)]),_:1}),t(u,{label:"操作","min-width":"200",align:"center",fixed:"right"},{default:a(l=>[s("div",He,[t(i,{type:"primary",size:"small",plain:"",class:"action-button detail-button",onClick:L=>de(l.row.id)},{default:a(()=>[t(r,null,{default:a(()=>[t(M(Ce))]),_:1}),e[21]||(e[21]=s("span",null,"查看详情",-1))]),_:2},1032,["onClick"]),t(i,{type:"info",size:"small",plain:"",class:"action-button image-button",onClick:L=>ce(l.row.id)},{default:a(()=>[t(r,null,{default:a(()=>[t(M(Ie))]),_:1}),e[22]||(e[22]=s("span",null,"查看图像",-1))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[O,x.value]]),s("div",Je,[t(fe,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:H.value,"page-sizes":[5,10,20,50],"page-size":F.value,"current-page":w.value,onSizeChange:oe,onCurrentChange:se},null,8,["total","page-size","current-page"])])])]),t(A,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=l=>V.value=l),title:"检测结果详情",width:"70%","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[s("span",Xe,[t(i,{onClick:e[5]||(e[5]=l=>V.value=!1)},{default:a(()=>e[26]||(e[26]=[m("关闭")])),_:1})])]),default:a(()=>[j((g(),_("div",null,[p.value?(g(),_(T,{key:0},[t(ge,{column:2,border:""},{default:a(()=>[t(b,{label:"ID"},{default:a(()=>[m(v(p.value.id),1)]),_:1}),t(b,{label:"设备名称"},{default:a(()=>[m(v(p.value.hostname),1)]),_:1}),t(b,{label:"产品"},{default:a(()=>[m(v(p.value.product),1)]),_:1}),t(b,{label:"产品ID"},{default:a(()=>[m(v(p.value.product_id),1)]),_:1}),t(b,{label:"检测结果"},{default:a(()=>[t(Q,{type:p.value.ok===1?"success":"danger"},{default:a(()=>[m(v(p.value.ok===1?"合格":"不合格"),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"系统"},{default:a(()=>[m(v(p.value.system),1)]),_:1}),t(b,{label:"MAC地址"},{default:a(()=>[m(v(p.value.mac_addr),1)]),_:1}),t(b,{label:"检测时间"},{default:a(()=>[m(v(p.value.create_time),1)]),_:1})]),_:1}),p.value.ng_errors&&p.value.ng_errors.length>0?(g(),_("div",Ke,[e[23]||(e[23]=s("h3",null,"错误明细",-1)),t(P,{data:p.value.ng_errors,border:"",style:{width:"100%"}},{default:a(()=>[t(u,{prop:"id",label:"ID",width:"80"}),t(u,{prop:"error_code",label:"错误代码"}),t(u,{prop:"file_id",label:"关联文件ID"}),t(u,{prop:"create_time",label:"创建时间"})]),_:1},8,["data"])])):$("",!0),p.value.image_files&&p.value.image_files.length>0?(g(),_("div",Qe,[e[25]||(e[25]=s("h3",null,"图片文件",-1)),t(P,{data:p.value.image_files,border:"",style:{width:"100%"}},{default:a(()=>[t(u,{prop:"id",label:"ID",width:"80"}),t(u,{prop:"filename",label:"文件名"}),t(u,{prop:"create_time",label:"创建时间"}),t(u,{label:"操作",width:"100",align:"center"},{default:a(l=>[t(i,{type:"primary",size:"small",plain:"",onClick:L=>pe(l.row)},{default:a(()=>e[24]||(e[24]=[m("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):$("",!0)],64)):$("",!0)])),[[O,U.value]])]),_:1},8,["modelValue"]),t(A,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=l=>C.value=l),title:"检测图片",width:"70%","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[s("span",ot,[t(i,{onClick:e[7]||(e[7]=l=>C.value=!1)},{default:a(()=>e[28]||(e[28]=[m("关闭")])),_:1})])]),default:a(()=>[j((g(),_("div",null,[Y.value.length>0?(g(),_("div",Ze,[(g(!0),_(T,null,ee(Y.value,(l,L)=>(g(),_("div",{key:L,class:"image-item"},[s("div",et,[s("div",tt,[t(X,{src:l.filename,alt:l.filename,class:"image-preview",onError:Z=>J(Z,l),"preview-src-list":[l.filename]},null,8,["src","alt","onError","preview-src-list"]),s("div",lt,[t(i,{type:"primary",size:"small",onClick:Z=>K(l.filename)},{default:a(()=>e[27]||(e[27]=[m(" 复制路径 ")])),_:2},1032,["onClick"])])]),s("div",at,[s("div",st,v(l.create_time),1)])])]))),128))])):(g(),q(_e,{key:1,description:"暂无图片"}))])),[[O,B.value]])]),_:1},8,["modelValue"]),t(A,{modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=l=>S.value=l),title:"检测图片",width:"50%","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[s("span",it,[t(i,{onClick:e[11]||(e[11]=l=>S.value=!1)},{default:a(()=>e[30]||(e[30]=[m("关闭")])),_:1})])]),default:a(()=>[h.value?(g(),_("div",nt,[t(X,{src:h.value.filename,alt:h.value.filename,class:"single-image-preview",onError:e[9]||(e[9]=l=>J(l,h.value)),"preview-src-list":[h.value.filename],fit:"contain"},null,8,["src","alt","preview-src-list"]),s("div",rt,[t(i,{type:"primary",size:"small",onClick:e[10]||(e[10]=l=>K(h.value.filename))},{default:a(()=>e[29]||(e[29]=[m(" 复制路径 ")])),_:1})])])):$("",!0)]),_:1},8,["modelValue"])])}}}),vt=Me(dt,[["__scopeId","data-v-8980d375"]]);export{vt as default};
