import{d as lt,c as at,r as u,a as ot,p as st,b as _,e as s,f as t,x as k,G as x,w as o,i as m,g as w,u as V,z as nt,L as Me,F as P,B as G,M as rt,D as it,s as te,v as dt,t as h,R as ct,S as ut,T as ft,U as pt,m as p,o as c}from"./index-CCQ4VAXS.js";import{r as L}from"./resultApi-ChXHL17r.js";import{_ as vt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const gt={class:"result-management-container"},mt={class:"content-card"},_t={class:"card-header"},wt={class:"action-bar"},ht={class:"filter-bar"},yt={class:"filter-group"},bt={class:"filter-group"},kt={class:"filter-group"},Dt={class:"filter-group"},Ct={class:"filter-buttons"},It={class:"table-container"},$t={class:"data-cell id-cell"},Vt={class:"data-cell device-cell"},Et={class:"data-cell product-cell"},Nt={class:"data-cell product-id-cell"},Pt={key:0,class:"data-cell error-cell"},Lt={key:1,class:"data-cell error-cell"},St={class:"data-cell time-cell"},Mt={class:"data-cell system-cell"},Rt={class:"button-group-horizontal"},Ut={class:"pagination"},Tt={class:"content-card"},zt={class:"statistics-cards"},xt={class:"stat-card-content"},Gt={class:"stat-icon"},At={class:"stat-info"},Ft={class:"stat-value"},Bt={class:"stat-card-content"},Ht={class:"stat-icon error"},Yt={class:"stat-info"},Ot={class:"stat-value"},jt={class:"error-stats-container"},Wt={class:"detail-section"},Qt={key:0,class:"detail-section"},qt={class:"dialog-footer"},Jt={key:0,class:"image-grid"},Kt={class:"image-card"},Xt={class:"image-container"},Zt={class:"image-path-overlay"},el={class:"image-info"},tl={class:"image-time"},ll={class:"dialog-footer"},al={key:0,class:"single-image-container"},ol={class:"image-path-overlay"},sl={class:"dialog-footer"},nl={class:"download-options"},rl={key:0,class:"download-progress-container"},il={class:"progress-info"},dl={class:"progress-text"},cl={class:"progress-count"},ul={class:"download-actions"},fl={key:0,class:"grouped-images"},pl={class:"product-group"},vl={class:"product-id-group"},gl={class:"result-group"},ml={class:"result-actions"},_l={class:"image-list"},wl={class:"dialog-footer"},hl=lt({__name:"NgResultManagement",setup(yl){const Ie=at(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}").is_admin===!0}catch{return!1}}),$e=u([]),ue=u(!1),le=u("custom"),d=ot({date:[],product:"",productId:"",errorCode:""}),fe=u(!1),Ve=u({total_ng:0,recent_ng:0,product_stats:[]}),O=u([]),Re=l=>{const e=new Date,r=a=>{const i=a.getFullYear(),v=String(a.getMonth()+1).padStart(2,"0"),g=String(a.getDate()).padStart(2,"0");return`${i}-${v}-${g}`};switch(l){case"custom":break;case"today":d.date=[r(e),r(e)];break;case"yesterday":const a=new Date(e);a.setDate(e.getDate()-1),d.date=[r(a),r(a)];break;case"last7days":const i=new Date(e);i.setDate(e.getDate()-6),d.date=[r(i),r(e)];break;case"last30days":const v=new Date(e);v.setDate(e.getDate()-29),d.date=[r(v),r(e)];break;case"thisMonth":const g=new Date(e.getFullYear(),e.getMonth(),1);d.date=[r(g),r(e)];break;case"lastMonth":const I=new Date(e.getFullYear(),e.getMonth()-1,1),f=new Date(e.getFullYear(),e.getMonth(),0);d.date=[r(I),r(f)];break}S(),j(),W()},Ue=async()=>{ue.value=!0;try{const l=await L.getProductList();$e.value=l}catch(l){console.error("获取产品列表失败:",l),p.error("获取产品列表失败")}finally{ue.value=!1}},j=async()=>{try{const l={};d.date&&d.date.length>0&&(l.start_date=d.date[0],d.date.length>1&&(l.end_date=d.date[1])),Ve.value=await L.getNgStatistics(l)}catch(l){console.error("获取NG结果统计失败:",l),p.error("获取NG结果统计失败")}},W=async()=>{fe.value=!0;try{const l={};d.date&&d.date.length>0&&(l.start_date=d.date[0],d.date.length>1&&(l.end_date=d.date[1])),O.value=await L.getErrorTypeStats(l)}catch(l){console.error("获取错误类型统计失败:",l),p.error("获取错误类型统计失败")}finally{fe.value=!1}},Ee=l=>{const e=O.value.reduce((r,a)=>r+a.count,0);return e===0?0:Math.round(l/e*100)},Te=l=>{const e=Ee(l);return e>50?"#F56C6C":e>25?"#E6A23C":"#67C23A"},pe=u([]),ae=u(!1),Ne=u(0),A=u(1),ve=u(10),S=async()=>{ae.value=!0;try{const l=d.date&&d.date.length>0?d.date[0]:void 0,e=d.date&&d.date.length>1?d.date[1]:void 0,r={page:A.value,page_size:ve.value};l&&(r.start_date=l),e&&(r.end_date=e),d.product&&(r.product=d.product),d.productId&&(r.product_id=d.productId),d.errorCode&&(r.error_code=d.errorCode);const a=await L.getNgResultList(r);pe.value=a.items,Ne.value=a.total}catch(l){console.error("获取NG检测结果列表失败:",l),p.error("获取NG检测结果列表失败")}finally{ae.value=!1}},ze=l=>{A.value=l,S()},xe=l=>{ve.value=l,A.value=1,S()},Ge=()=>{A.value=1,S(),j(),W()},Ae=()=>{le.value="custom",d.date=[],d.product="",d.productId="",d.errorCode="",A.value=1,S(),j(),W()},Fe=()=>{S(),j(),W()},Q=u(!1),y=u(null),ge=u(!1),oe=u(!1),q=u([]),Be=async l=>{ge.value=!0,oe.value=!0,Q.value=!0;try{const e=await L.getResultDetail(l);y.value=e;const r=pe.value.find(a=>a.id===l);if(r&&r.ng_errors&&r.ng_errors.length>0)q.value=r.ng_errors;else try{const a=await L.getNgResultErrors(l);q.value=a.items}catch(a){console.error("获取错误明细失败:",a),q.value=[]}oe.value=!1}catch(e){console.error("获取检测结果详情失败:",e),p.error("获取检测结果详情失败"),Q.value=!1,oe.value=!1}finally{ge.value=!1}},J=u(!1),me=u([]),_e=u(!1),He=u(null),Ye=async l=>{_e.value=!0,J.value=!0,He.value=l;try{const e=await L.getResultImages(l);me.value=e.items}catch(e){console.error("获取检测结果图片失败:",e),p.error("获取检测结果图片失败"),J.value=!1}finally{_e.value=!1}},se=u(!1),M=u(null),Oe=l=>{M.value=l,se.value=!0},Pe=(l,e)=>{const r=l.target;r.style.display="none";const a=r.parentElement;if(a&&!a.querySelector(".image-path-display")){const i=document.createElement("div");i.className="image-path-display",i.textContent=e.filename,a.insertBefore(i,a.firstChild)}console.error("图片加载失败:",e.filename)},we=l=>{navigator.clipboard.writeText(l).then(()=>{p.success("文件路径已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e),p.error("复制失败")})},ne=u([]),je=u(!1),We=l=>{ne.value=l},K=u(!1),re=u(!1),D=u([]),F=u({}),B=u(0),X=u(0),R=u(0),E=u(!1),U=u(""),Qe=async()=>{if(ne.value.length===0){p.warning("请至少选择一个NG结果");return}re.value=!0,K.value=!0;try{const l=ne.value.map(r=>r.id),e=await L.getNgImageUrls(l);D.value=e.images,F.value=e.grouped_images,D.value.length===0&&p.warning("未找到可下载的图片")}catch(l){console.error("获取图片URL列表失败:",l),p.error(`获取图片URL列表失败: ${l instanceof Error?l.message:"未知错误"}`),K.value=!1}finally{re.value=!1}},Z=async(l,e,r)=>{try{if(r){const a=await fetch(l,{credentials:"include",mode:"cors"});if(!a.ok)throw new Error(`图片获取失败: HTTP ${a.status}`);const i=await a.blob(),v=await r.createWritable();return await v.write(i),await v.close(),!0}else{try{const a=await fetch(l,{credentials:"include",mode:"cors"});if(!a.ok)throw new Error(`图片获取失败: HTTP ${a.status}`);const i=await a.blob(),v=URL.createObjectURL(i),g=document.createElement("a");g.href=v,g.download=e,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(v)}catch(a){console.error("通过Blob下载失败，尝试直接下载:",a);const i=document.createElement("a");i.href=l,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}return!0}}catch(a){return console.error("下载图片失败:",a),p.error(`下载图片失败: ${a instanceof Error?a.message:"未知错误"}`),!1}},qe=async()=>{if(D.value.length===0){p.warning("没有可下载的图片");return}E.value=!1;try{if("showDirectoryPicker"in window&&typeof window.showDirectoryPicker=="function")try{const l=await window.showDirectoryPicker({id:"ngImagesDownloadDir",mode:"readwrite",startIn:"downloads"});E.value=!0,X.value=D.value.length,R.value=0,B.value=0,U.value="准备下载...";let e=0,r=0;for(let a=0;a<D.value.length;a++){const i=D.value[a];try{const v=await l.getFileHandle(i.filename,{create:!0});U.value=`正在下载: ${i.filename}`,await Z(i.url,i.filename,v)?e++:r++,R.value=a+1,B.value=Math.round(R.value/X.value*100)}catch(v){console.error("文件创建失败:",v),r++}a<D.value.length-1&&await new Promise(v=>setTimeout(v,100))}U.value="下载完成",setTimeout(()=>{E.value=!1},2e3),r===0?p.success(`成功下载 ${e} 张图片到选择的文件夹`):p.warning(`下载完成，成功: ${e} 张，失败: ${r} 张`)}catch(l){typeof l=="object"&&l!==null&&"name"in l&&l.name!=="AbortError"&&(console.error("目录选择失败:",l),p.error("选择保存目录失败"))}else{p.info("您的浏览器不支持选择保存位置，将使用默认下载位置");const l=D.value.map((e,r)=>()=>new Promise(a=>{setTimeout(()=>{Z(e.url,e.filename),a()},r*300)}));await Promise.all(l.map(e=>e())),p.success(`已开始下载 ${D.value.length} 张图片`)}}catch(l){console.error("批量下载图片失败:",l),p.error("批量下载图片失败")}},Je=l=>{let e=0;const r=F.value[l]||{};for(const a in r)e+=Le(l,a);return e},Le=(l,e)=>{var i;let r=0;const a=((i=F.value[l])==null?void 0:i[e])||{};for(const v in a)r+=a[v].length;return r},Ke=async(l,e,r)=>{var i,v;E.value=!1;const a=((v=(i=F.value[l])==null?void 0:i[e])==null?void 0:v[r])||[];if(a.length===0){p.warning("该组没有可下载的图片");return}try{if("showDirectoryPicker"in window&&typeof window.showDirectoryPicker=="function")try{const g=await window.showDirectoryPicker({id:"ngImagesDownloadDir",mode:"readwrite",startIn:"downloads"}),I=`${l}_${e}_${r}`;let f;try{f=await g.getDirectoryHandle(I,{create:!0})}catch($){console.error("无法创建子文件夹，将直接保存到选择的目录:",$),f=g}E.value=!0,X.value=a.length,R.value=0,B.value=0,U.value="准备下载...";let C=0,H=0;for(let $=0;$<a.length;$++){const T=a[$];try{const z=await f.getFileHandle(T.filename,{create:!0});U.value=`正在下载: ${T.filename}`,await Z(T.url,T.filename,z)?C++:H++,R.value=$+1,B.value=Math.round(R.value/X.value*100)}catch(z){console.error("文件创建失败:",z),H++}$<a.length-1&&await new Promise(z=>setTimeout(z,100))}U.value="下载完成",setTimeout(()=>{E.value=!1},2e3),H===0?p.success(`成功下载 ${C} 张图片到选择的文件夹`):p.warning(`下载完成，成功: ${C} 张，失败: ${H} 张`)}catch(g){typeof g=="object"&&g!==null&&"name"in g&&g.name!=="AbortError"&&(console.error("目录选择失败:",g),p.error("选择保存目录失败"))}else{p.info("您的浏览器不支持选择保存位置，将使用默认下载位置");const g=a.map((I,f)=>()=>new Promise(C=>{setTimeout(()=>{Z(I.url,I.filename),C()},f*300)}));await Promise.all(g.map(I=>I())),p.success(`已开始下载 ${a.length} 张图片`)}}catch(g){console.error("批量下载图片失败:",g),p.error("批量下载图片失败")}};return st(()=>{Ue(),S(),j(),W()}),(l,e)=>{const r=w("el-icon"),a=w("el-button"),i=w("el-option"),v=w("el-select"),g=w("el-date-picker"),I=w("el-input"),f=w("el-table-column"),C=w("el-table"),H=w("el-pagination"),$=w("el-card"),T=w("el-col"),z=w("el-row"),he=w("el-progress"),N=w("el-descriptions-item"),Xe=w("el-tag"),Ze=w("el-descriptions"),ye=w("el-empty"),ie=w("el-dialog"),Se=w("el-image"),et=w("el-alert"),be=w("el-collapse-item"),ke=w("el-collapse"),ee=dt("loading");return c(),_("div",gt,[e[42]||(e[42]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",{class:"page-title"},"NG结果管理"),s("div",{class:"page-description"},"查看和管理所有不合格(NG)的检测结果数据")])],-1)),s("div",mt,[s("div",_t,[e[17]||(e[17]=s("div",{class:"card-title"},"NG结果列表",-1)),s("div",wt,[t(a,{type:"primary",class:"primary-button",onClick:Fe,loading:ae.value},{default:o(()=>[t(r,null,{default:o(()=>[t(V(nt))]),_:1}),e[15]||(e[15]=m("刷新数据 "))]),_:1},8,["loading"]),Ie.value?(c(),k(a,{key:0,type:"success",class:"download-button",onClick:Qe,disabled:ne.value.length===0,loading:je.value},{default:o(()=>[t(r,null,{default:o(()=>[t(V(Me))]),_:1}),e[16]||(e[16]=m("批量下载图片 "))]),_:1},8,["disabled","loading"])):x("",!0)])]),s("div",ht,[s("div",yt,[e[18]||(e[18]=s("span",{class:"filter-label"},"检测日期：",-1)),t(v,{modelValue:le.value,"onUpdate:modelValue":e[0]||(e[0]=n=>le.value=n),placeholder:"选择时间范围",class:"date-range-select",onChange:Re},{default:o(()=>[t(i,{label:"自定义",value:"custom"}),t(i,{label:"今天",value:"today"}),t(i,{label:"昨天",value:"yesterday"}),t(i,{label:"最近7天",value:"last7days"}),t(i,{label:"最近30天",value:"last30days"}),t(i,{label:"本月",value:"thisMonth"}),t(i,{label:"上月",value:"lastMonth"})]),_:1},8,["modelValue"]),t(g,{modelValue:d.date,"onUpdate:modelValue":e[1]||(e[1]=n=>d.date=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"date-picker","value-format":"YYYY-MM-DD",disabled:le.value!=="custom"},null,8,["modelValue","disabled"])]),s("div",bt,[e[19]||(e[19]=s("span",{class:"filter-label"},"产品名称：",-1)),t(v,{modelValue:d.product,"onUpdate:modelValue":e[2]||(e[2]=n=>d.product=n),placeholder:"请选择",class:"filter-select",loading:ue.value},{default:o(()=>[t(i,{label:"全部",value:""}),(c(!0),_(P,null,G($e.value,n=>(c(),k(i,{key:n.product,label:n.product,value:n.product},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),s("div",kt,[e[20]||(e[20]=s("span",{class:"filter-label"},"产品ID：",-1)),t(I,{modelValue:d.productId,"onUpdate:modelValue":e[3]||(e[3]=n=>d.productId=n),placeholder:"请输入产品ID",clearable:"",class:"filter-input"},null,8,["modelValue"])]),s("div",Dt,[e[21]||(e[21]=s("span",{class:"filter-label"},"错误名称：",-1)),t(v,{modelValue:d.errorCode,"onUpdate:modelValue":e[4]||(e[4]=n=>d.errorCode=n),placeholder:"请选择",class:"filter-select",loading:fe.value},{default:o(()=>[t(i,{label:"全部",value:""}),(c(!0),_(P,null,G(O.value,n=>(c(),k(i,{key:n.error_code,label:n.error_code,value:n.error_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),s("div",Ct,[t(a,{type:"primary",class:"primary-button",onClick:Ge},{default:o(()=>[t(r,null,{default:o(()=>[t(V(rt))]),_:1}),e[22]||(e[22]=m("查询 "))]),_:1}),t(a,{onClick:Ae},{default:o(()=>[t(r,null,{default:o(()=>[t(V(it))]),_:1}),e[23]||(e[23]=m("重置 "))]),_:1})])]),s("div",It,[te((c(),k(C,{data:pe.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{padding:"12px 0"},"highlight-current-row":"",class:"result-table",onSelectionChange:We},{default:o(()=>[Ie.value?(c(),k(f,{key:0,type:"selection",width:"55",align:"center"})):x("",!0),t(f,{prop:"id",label:"ID","min-width":"80",align:"center"},{default:o(n=>[s("span",$t,h(n.row.id),1)]),_:1}),t(f,{prop:"hostname",label:"设备名称","min-width":"150",align:"center"},{default:o(n=>[s("span",Vt,h(n.row.hostname),1)]),_:1}),t(f,{prop:"product",label:"产品","min-width":"120",align:"center"},{default:o(n=>[s("span",Et,h(n.row.product),1)]),_:1}),t(f,{prop:"product_id",label:"产品ID","min-width":"120",align:"center"},{default:o(n=>[s("span",Nt,h(n.row.product_id),1)]),_:1}),t(f,{label:"错误明细","min-width":"150",align:"center"},{default:o(n=>[n.row.ng_errors&&n.row.ng_errors.length>0?(c(),_("div",Pt,[(c(!0),_(P,null,G(n.row.ng_errors,(b,Y)=>(c(),_("div",{key:Y,class:"error-code-item"},h(b.error_code),1))),128))])):(c(),_("span",Lt,"-"))]),_:1}),t(f,{prop:"create_time",label:"检测时间","min-width":"180",align:"center"},{default:o(n=>[s("span",St,h(n.row.create_time),1)]),_:1}),t(f,{prop:"system",label:"系统","min-width":"100",align:"center"},{default:o(n=>[s("span",Mt,h(n.row.system),1)]),_:1}),t(f,{label:"操作","min-width":"200",align:"center",fixed:"right"},{default:o(n=>[s("div",Rt,[t(a,{type:"primary",size:"small",plain:"",class:"action-button detail-button",onClick:b=>Be(n.row.id)},{default:o(()=>[t(r,null,{default:o(()=>[t(V(ct))]),_:1}),e[24]||(e[24]=s("span",null,"查看详情",-1))]),_:2},1032,["onClick"]),t(a,{type:"info",size:"small",plain:"",class:"action-button image-button",onClick:b=>Ye(n.row.id)},{default:o(()=>[t(r,null,{default:o(()=>[t(V(ut))]),_:1}),e[25]||(e[25]=s("span",null,"查看图像",-1))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ee,ae.value]]),s("div",Ut,[t(H,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:Ne.value,"page-sizes":[5,10,20,50,100],"page-size":ve.value,"current-page":A.value,onSizeChange:xe,onCurrentChange:ze},null,8,["total","page-size","current-page"])])])]),s("div",Tt,[s("div",zt,[t(z,{gutter:20},{default:o(()=>[t(T,{span:12},{default:o(()=>[t($,{class:"stat-card",shadow:"hover"},{default:o(()=>[s("div",xt,[s("div",Gt,[t(r,null,{default:o(()=>[t(V(ft))]),_:1})]),s("div",At,[e[26]||(e[26]=s("div",{class:"stat-title"},"NG结果总数",-1)),s("div",Ft,h(Ve.value.total_ng),1)])])]),_:1})]),_:1}),t(T,{span:12},{default:o(()=>[t($,{class:"stat-card",shadow:"hover"},{default:o(()=>[s("div",Bt,[s("div",Ht,[t(r,null,{default:o(()=>[t(V(pt))]),_:1})]),s("div",Yt,[e[27]||(e[27]=s("div",{class:"stat-title"},"错误类型数量",-1)),s("div",Ot,h(O.value.length),1)])])]),_:1})]),_:1})]),_:1})]),e[28]||(e[28]=s("div",{class:"card-header"},[s("div",{class:"card-title"},"错误类型统计")],-1)),s("div",jt,[t(C,{data:O.value,border:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},class:"error-table"},{default:o(()=>[t(f,{prop:"error_code",label:"错误代码","min-width":"200"}),t(f,{prop:"count",label:"出现次数","min-width":"100",align:"center"}),t(f,{label:"占比","min-width":"200",align:"center"},{default:o(n=>[t(he,{percentage:Ee(n.row.count),color:Te(n.row.count)},null,8,["percentage","color"])]),_:1})]),_:1},8,["data"])])]),t(ie,{modelValue:Q.value,"onUpdate:modelValue":e[6]||(e[6]=n=>Q.value=n),title:"NG结果详情",width:"70%","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[s("span",qt,[t(a,{onClick:e[5]||(e[5]=n=>Q.value=!1)},{default:o(()=>e[33]||(e[33]=[m("关闭")])),_:1})])]),default:o(()=>[te((c(),_("div",null,[y.value?(c(),_(P,{key:0},[t(Ze,{column:2,border:""},{default:o(()=>[t(N,{label:"ID"},{default:o(()=>[m(h(y.value.id),1)]),_:1}),t(N,{label:"设备名称"},{default:o(()=>[m(h(y.value.hostname),1)]),_:1}),t(N,{label:"产品"},{default:o(()=>[m(h(y.value.product),1)]),_:1}),t(N,{label:"产品ID"},{default:o(()=>[m(h(y.value.product_id),1)]),_:1}),t(N,{label:"检测结果"},{default:o(()=>[t(Xe,{type:"danger"},{default:o(()=>e[29]||(e[29]=[m("不合格")])),_:1})]),_:1}),t(N,{label:"系统"},{default:o(()=>[m(h(y.value.system),1)]),_:1}),t(N,{label:"MAC地址"},{default:o(()=>[m(h(y.value.mac_addr),1)]),_:1}),t(N,{label:"检测时间"},{default:o(()=>[m(h(y.value.create_time),1)]),_:1})]),_:1}),s("div",Wt,[e[30]||(e[30]=s("h3",null,"错误明细",-1)),te((c(),_("div",null,[q.value.length>0?(c(),k(C,{key:0,data:q.value,border:"",style:{width:"100%"}},{default:o(()=>[t(f,{prop:"id",label:"ID",width:"80"}),t(f,{prop:"error_code",label:"错误代码"}),t(f,{prop:"file_id",label:"关联文件ID"}),t(f,{prop:"create_time",label:"创建时间"})]),_:1},8,["data"])):(c(),k(ye,{key:1,description:"暂无错误明细"}))])),[[ee,oe.value]])]),y.value.image_files&&y.value.image_files.length>0?(c(),_("div",Qt,[e[32]||(e[32]=s("h3",null,"图片文件",-1)),t(C,{data:y.value.image_files,border:"",style:{width:"100%"}},{default:o(()=>[t(f,{prop:"id",label:"ID",width:"80"}),t(f,{prop:"filename",label:"文件名"}),t(f,{prop:"create_time",label:"创建时间"}),t(f,{label:"操作",width:"100",align:"center"},{default:o(n=>[t(a,{type:"primary",size:"small",plain:"",onClick:b=>Oe(n.row)},{default:o(()=>e[31]||(e[31]=[m("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):x("",!0)],64)):x("",!0)])),[[ee,ge.value]])]),_:1},8,["modelValue"]),t(ie,{modelValue:J.value,"onUpdate:modelValue":e[8]||(e[8]=n=>J.value=n),title:"检测图片",width:"70%","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[s("span",ll,[t(a,{onClick:e[7]||(e[7]=n=>J.value=!1)},{default:o(()=>e[35]||(e[35]=[m("关闭")])),_:1})])]),default:o(()=>[te((c(),_("div",null,[me.value.length>0?(c(),_("div",Jt,[(c(!0),_(P,null,G(me.value,(n,b)=>(c(),_("div",{key:b,class:"image-item"},[s("div",Kt,[s("div",Xt,[t(Se,{src:n.filename,alt:n.filename,class:"image-preview",onError:Y=>Pe(Y,n),"preview-src-list":[n.filename]},null,8,["src","alt","onError","preview-src-list"]),s("div",Zt,[t(a,{type:"primary",size:"small",onClick:Y=>we(n.filename)},{default:o(()=>e[34]||(e[34]=[m(" 复制路径 ")])),_:2},1032,["onClick"])])]),s("div",el,[s("div",tl,h(n.create_time),1)])])]))),128))])):(c(),k(ye,{key:1,description:"暂无图片"}))])),[[ee,_e.value]])]),_:1},8,["modelValue"]),t(ie,{modelValue:se.value,"onUpdate:modelValue":e[12]||(e[12]=n=>se.value=n),title:"检测图片",width:"50%","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[s("span",sl,[t(a,{onClick:e[11]||(e[11]=n=>se.value=!1)},{default:o(()=>e[37]||(e[37]=[m("关闭")])),_:1})])]),default:o(()=>[M.value?(c(),_("div",al,[t(Se,{src:M.value.filename,alt:M.value.filename,class:"single-image-preview",onError:e[9]||(e[9]=n=>Pe(n,M.value)),"preview-src-list":[M.value.filename],fit:"contain"},null,8,["src","alt","preview-src-list"]),s("div",ol,[t(a,{type:"primary",size:"small",onClick:e[10]||(e[10]=n=>we(M.value.filename))},{default:o(()=>e[36]||(e[36]=[m(" 复制路径 ")])),_:1})])])):x("",!0)]),_:1},8,["modelValue"]),t(ie,{modelValue:K.value,"onUpdate:modelValue":e[14]||(e[14]=n=>K.value=n),title:"批量下载图片",width:"80%","close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[s("span",wl,[t(a,{onClick:e[13]||(e[13]=n=>K.value=!1)},{default:o(()=>e[41]||(e[41]=[m("关闭")])),_:1})])]),default:o(()=>[te((c(),_("div",null,[s("div",nl,[t(et,{title:"图片下载说明",type:"info",description:"您可以选择直接下载所有图片，或按产品/产品ID/结果ID分组下载。图片将直接下载到您的浏览器默认下载位置。","show-icon":"",closable:!1,class:"download-alert"}),E.value?(c(),_("div",rl,[s("div",il,[s("span",dl,h(U.value),1),s("span",cl,h(R.value)+"/"+h(X.value),1)]),t(he,{percentage:B.value,"stroke-width":18,format:n=>`${n}%`,status:B.value===100?"success":""},null,8,["percentage","format","status"])])):x("",!0),s("div",ul,[t(a,{type:"primary",onClick:qe,disabled:D.value.length===0||E.value},{default:o(()=>[t(r,null,{default:o(()=>[t(V(Me))]),_:1}),m("下载所有图片 ("+h(D.value.length)+"张) ",1)]),_:1},8,["disabled"])])]),Object.keys(F.value).length>0?(c(),_("div",fl,[e[40]||(e[40]=s("h3",null,"按产品分组",-1)),t(ke,{accordion:""},{default:o(()=>[(c(!0),_(P,null,G(F.value,(n,b)=>(c(),k(be,{key:b,title:`${b} (${Je(b)}张)`},{default:o(()=>[s("div",pl,[t(ke,{accordion:""},{default:o(()=>[(c(!0),_(P,null,G(n,(Y,de)=>(c(),k(be,{key:de,title:`产品ID: ${de} (${Le(b,de)}张)`},{default:o(()=>[s("div",vl,[t(ke,{accordion:""},{default:o(()=>[(c(!0),_(P,null,G(Y,(De,Ce)=>(c(),k(be,{key:Ce,title:`结果ID: ${Ce} (${De.length}张)`},{default:o(()=>[s("div",gl,[s("div",ml,[t(a,{type:"primary",size:"small",onClick:ce=>Ke(b,de,Number(Ce))},{default:o(()=>[m(" 下载此组图片 ("+h(De.length)+"张) ",1)]),_:2},1032,["onClick"])]),s("div",_l,[t(C,{data:De,border:"",style:{width:"100%"}},{default:o(()=>[t(f,{prop:"filename",label:"文件名","min-width":"200"}),t(f,{prop:"create_time",label:"创建时间",width:"180"}),t(f,{label:"操作",width:"180",align:"center"},{default:o(ce=>[t(a,{type:"primary",size:"small",onClick:tt=>Z(ce.row.url,ce.row.filename)},{default:o(()=>e[38]||(e[38]=[m(" 下载 ")])),_:2},1032,["onClick"]),t(a,{type:"info",size:"small",onClick:tt=>we(ce.row.url)},{default:o(()=>e[39]||(e[39]=[m(" 复制URL ")])),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])])])]),_:2},1032,["title"]))),128))]),_:2},1024)])]),_:2},1032,["title"]))),128))]),_:2},1024)])]),_:2},1032,["title"]))),128))]),_:1})])):re.value?x("",!0):(c(),k(ye,{key:1,description:"未找到可下载的图片"}))])),[[ee,re.value]])]),_:1},8,["modelValue"])])}}}),Cl=vt(hl,[["__scopeId","data-v-519965fb"]]);export{Cl as default};
