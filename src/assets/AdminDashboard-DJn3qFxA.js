import{d as me,r as g,a as B,p as pe,b as F,e as s,f as t,w as a,i as b,g as c,u as k,z as fe,s as K,v as _e,x as $,t as f,F as O,B as P,C as Q,D as X,G as ge,A as v,m as p,H as Y,o as w}from"./index-CCQ4VAXS.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"admin-dashboard"},we={class:"content-card"},ye={class:"card-header"},Ve={class:"action-bar"},he={class:"tab-header"},ke={class:"data-cell id-cell"},xe={class:"data-cell device-cell"},Ce={class:"tag-content"},Ue={class:"tag-text"},De={class:"data-cell time-cell"},Re={class:"data-cell time-cell"},Be={class:"button-group-horizontal"},Fe={class:"tab-header"},$e={class:"data-cell id-cell"},Te={class:"data-cell device-cell"},ze={class:"data-cell product-cell"},Ae={class:"data-cell time-cell"},Ie={class:"data-cell time-cell"},Ne={class:"button-group-horizontal"},qe={key:0,class:"form-tip"},Ee={class:"dialog-footer"},Me={class:"dialog-footer"},We=me({__name:"AdminDashboard",setup(Ge){const T=g(null),q=g("users"),E=g([]),z=g([]),A=g(),I=g(),u=B({users:!1,roles:!1,submit:!1}),_=B({user:!1,role:!1}),h=g("create"),N=g("create"),x=g(null),C=g(null),i=B({username:"",password:"",is_active:1,roles:[]}),m=B({role_name:"",description:""}),Z={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:function(){return h.value==="create"},message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}]},ee={role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},le=async()=>{try{const n=await v.getCurrentUser();T.value=n}catch(n){console.error("获取当前用户信息失败:",n)}},U=async()=>{var n,e;u.users=!0;try{const o=await v.getUsers();E.value=(o.items||o).map(r=>({...r,roles:r.roles.map(d=>typeof d=="string"?{id:d,role_name:d}:d)}))}catch(o){console.error("获取用户列表失败:",o),p.error(((e=(n=o.response)==null?void 0:n.data)==null?void 0:e.message)||"获取用户列表失败")}finally{u.users=!1}},D=async()=>{var n,e;u.roles=!0;try{const o=await v.getRoles();z.value=o}catch(o){console.error("获取角色列表失败:",o),p.error(((e=(n=o.response)==null?void 0:n.data)==null?void 0:e.message)||"获取角色列表失败")}finally{u.roles=!1}},te=()=>{U(),D()},M=(n,e)=>{h.value=n,i.username="",i.password="",i.is_active=1,i.roles=[],n==="edit"&&e?(x.value=e.id,i.username=e.username,i.is_active=e.is_active,i.roles=e.roles.map(o=>o.id)):x.value=null,_.user=!0},W=(n,e)=>{N.value=n,m.role_name="",m.description="",n==="edit"&&e?(C.value=e.id,m.role_name=e.role_name,m.description=e.description||""):C.value=null,_.role=!0},ae=async()=>{A.value&&await A.value.validate(async n=>{var e,o;if(n){u.submit=!0;try{if(h.value==="create")await v.createUser({username:i.username,password:i.password,is_active:i.is_active,roles:i.roles}),p.success("用户创建成功");else if(x.value){const r={username:i.username,is_active:i.is_active,roles:i.roles};i.password&&(r.password=i.password),await v.updateUser(x.value,r),p.success("用户更新成功")}_.user=!1,U()}catch(r){console.error("操作失败:",r),p.error(((o=(e=r.response)==null?void 0:e.data)==null?void 0:o.message)||"操作失败")}finally{u.submit=!1}}})},se=async()=>{I.value&&await I.value.validate(async n=>{var e,o;if(n){u.submit=!0;try{N.value==="create"?(await v.createRole({role_name:m.role_name,description:m.description||void 0}),p.success("角色创建成功")):C.value&&(await v.updateRole(C.value,{role_name:m.role_name,description:m.description||void 0}),p.success("角色更新成功")),_.role=!1,D()}catch(r){console.error("操作失败:",r),p.error(((o=(e=r.response)==null?void 0:e.data)==null?void 0:o.message)||"操作失败")}finally{u.submit=!1}}})},oe=n=>{var e;if(n.id===((e=T.value)==null?void 0:e.id)){p.warning("不能删除当前登录用户");return}Y.confirm(`确定要删除用户 "${n.username}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var o,r;try{await v.deleteUser(n.id),p.success("用户删除成功"),U()}catch(d){console.error("删除失败:",d),p.error(((r=(o=d.response)==null?void 0:o.data)==null?void 0:r.message)||"删除失败")}}).catch(()=>{})},re=n=>{Y.confirm(`确定要删除角色 "${n.role_name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,o;try{await v.deleteRole(n.id),p.success("角色删除成功"),D()}catch(r){console.error("删除失败:",r),p.error(((o=(e=r.response)==null?void 0:e.data)==null?void 0:o.message)||"删除失败")}}).catch(()=>{})};return pe(()=>{le(),U(),D()}),(n,e)=>{const o=c("el-icon"),r=c("el-button"),d=c("el-table-column"),G=c("el-tag"),H=c("el-table"),L=c("el-tab-pane"),ne=c("el-tabs"),R=c("el-input"),V=c("el-form-item"),ie=c("el-switch"),de=c("el-option"),ue=c("el-select"),S=c("el-form"),j=c("el-dialog"),J=_e("loading");return w(),F("div",be,[e[27]||(e[27]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",{class:"page-title"},"系统管理"),s("div",{class:"page-description"},"管理系统用户和角色权限")])],-1)),s("div",we,[s("div",ye,[e[14]||(e[14]=s("div",{class:"card-title"},"管理面板",-1)),s("div",Ve,[t(r,{type:"primary",class:"primary-button",onClick:te,loading:u.users||u.roles},{default:a(()=>[t(o,null,{default:a(()=>[t(k(fe))]),_:1}),e[13]||(e[13]=b("刷新数据 "))]),_:1},8,["loading"])])]),t(ne,{modelValue:q.value,"onUpdate:modelValue":e[2]||(e[2]=l=>q.value=l),class:"admin-tabs"},{default:a(()=>[t(L,{label:"用户管理",name:"users"},{default:a(()=>[s("div",he,[e[16]||(e[16]=s("h2",null,"用户管理",-1)),t(r,{type:"primary",class:"primary-button",onClick:e[0]||(e[0]=l=>M("create"))},{default:a(()=>e[15]||(e[15]=[b("添加用户")])),_:1})]),K((w(),$(H,{data:E.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{padding:"12px 0"},class:"result-table"},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"80",align:"center"},{default:a(l=>[s("span",ke,f(l.row.id),1)]),_:1}),t(d,{prop:"username",width:"250",label:"用户名",align:"center"},{default:a(l=>[s("span",xe,f(l.row.username),1)]),_:1}),t(d,{label:"状态",width:"100",align:"center"},{default:a(l=>[t(G,{type:l.row.is_active?"success":"danger",effect:"light",class:"custom-tag"},{default:a(()=>[s("div",Ce,[s("span",Ue,f(l.row.is_active?"启用":"禁用"),1)])]),_:2},1032,["type"])]),_:1}),t(d,{label:"角色",width:"200",align:"center"},{default:a(l=>[(w(!0),F(O,null,P(l.row.roles,y=>(w(),$(G,{key:y.id,class:"role-tag",effect:"light"},{default:a(()=>[b(f(y.role_name),1)]),_:2},1024))),128))]),_:1}),t(d,{prop:"create_time",label:"创建时间",align:"center"},{default:a(l=>[s("span",De,f(l.row.create_time),1)]),_:1}),t(d,{prop:"modify_time",label:"修改时间",align:"center"},{default:a(l=>[s("span",Re,f(l.row.modify_time),1)]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(l=>{var y;return[s("div",Be,[t(r,{size:"small",type:"primary",plain:"",class:"action-button",onClick:ce=>M("edit",l.row)},{default:a(()=>[t(o,null,{default:a(()=>[t(k(Q))]),_:1}),e[17]||(e[17]=s("span",null,"编辑",-1))]),_:2},1032,["onClick"]),t(r,{size:"small",type:"danger",plain:"",class:"action-button",onClick:ce=>oe(l.row),disabled:l.row.id===((y=T.value)==null?void 0:y.id)},{default:a(()=>[t(o,null,{default:a(()=>[t(k(X))]),_:1}),e[18]||(e[18]=s("span",null,"删除",-1))]),_:2},1032,["onClick","disabled"])])]}),_:1})]),_:1},8,["data"])),[[J,u.users]])]),_:1}),t(L,{label:"角色管理",name:"roles"},{default:a(()=>[s("div",Fe,[e[20]||(e[20]=s("h2",null,"角色管理",-1)),t(r,{type:"primary",class:"primary-button",onClick:e[1]||(e[1]=l=>W("create"))},{default:a(()=>e[19]||(e[19]=[b("添加角色")])),_:1})]),K((w(),$(H,{data:z.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",textAlign:"center"},"cell-style":{padding:"12px 0"},class:"result-table"},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"80",align:"center"},{default:a(l=>[s("span",$e,f(l.row.id),1)]),_:1}),t(d,{prop:"role_name",label:"角色名称",align:"center"},{default:a(l=>[s("span",Te,f(l.row.role_name),1)]),_:1}),t(d,{prop:"description",label:"描述",align:"center"},{default:a(l=>[s("span",ze,f(l.row.description),1)]),_:1}),t(d,{prop:"create_time",label:"创建时间",width:"180",align:"center"},{default:a(l=>[s("span",Ae,f(l.row.create_time),1)]),_:1}),t(d,{prop:"modify_time",label:"修改时间",width:"180",align:"center"},{default:a(l=>[s("span",Ie,f(l.row.modify_time),1)]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(l=>[s("div",Ne,[t(r,{size:"small",type:"primary",plain:"",class:"action-button",onClick:y=>W("edit",l.row)},{default:a(()=>[t(o,null,{default:a(()=>[t(k(Q))]),_:1}),e[21]||(e[21]=s("span",null,"编辑",-1))]),_:2},1032,["onClick"]),t(r,{size:"small",type:"danger",plain:"",class:"action-button",onClick:y=>re(l.row)},{default:a(()=>[t(o,null,{default:a(()=>[t(k(X))]),_:1}),e[22]||(e[22]=s("span",null,"删除",-1))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[J,u.roles]])]),_:1})]),_:1},8,["modelValue"])]),t(j,{title:h.value==="create"?"添加用户":"编辑用户",modelValue:_.user,"onUpdate:modelValue":e[8]||(e[8]=l=>_.user=l),width:"500px","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[s("span",Ee,[t(r,{onClick:e[7]||(e[7]=l=>_.user=!1)},{default:a(()=>e[23]||(e[23]=[b("取消")])),_:1}),t(r,{type:"primary",class:"primary-button",onClick:ae,loading:u.submit},{default:a(()=>e[24]||(e[24]=[b(" 确定 ")])),_:1},8,["loading"])])]),default:a(()=>[t(S,{ref_key:"userFormRef",ref:A,model:i,rules:Z,"label-width":"100px"},{default:a(()=>[t(V,{label:"用户名",prop:"username"},{default:a(()=>[t(R,{modelValue:i.username,"onUpdate:modelValue":e[3]||(e[3]=l=>i.username=l)},null,8,["modelValue"])]),_:1}),t(V,{label:"密码",prop:"password"},{default:a(()=>[t(R,{modelValue:i.password,"onUpdate:modelValue":e[4]||(e[4]=l=>i.password=l),type:"password","show-password":""},null,8,["modelValue"]),h.value==="edit"?(w(),F("div",qe," 留空表示不修改密码 ")):ge("",!0)]),_:1}),t(V,{label:"状态"},{default:a(()=>[t(ie,{modelValue:i.is_active,"onUpdate:modelValue":e[5]||(e[5]=l=>i.is_active=l),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),t(V,{label:"角色"},{default:a(()=>[t(ue,{modelValue:i.roles,"onUpdate:modelValue":e[6]||(e[6]=l=>i.roles=l),placeholder:"请选择角色",style:{width:"100%"},multiple:""},{default:a(()=>[(w(!0),F(O,null,P(z.value,l=>(w(),$(de,{key:l.id,label:l.role_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(j,{title:N.value==="create"?"添加角色":"编辑角色",modelValue:_.role,"onUpdate:modelValue":e[12]||(e[12]=l=>_.role=l),width:"500px","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[s("span",Me,[t(r,{onClick:e[11]||(e[11]=l=>_.role=!1)},{default:a(()=>e[25]||(e[25]=[b("取消")])),_:1}),t(r,{type:"primary",class:"primary-button",onClick:se,loading:u.submit},{default:a(()=>e[26]||(e[26]=[b(" 确定 ")])),_:1},8,["loading"])])]),default:a(()=>[t(S,{ref_key:"roleFormRef",ref:I,model:m,rules:ee,"label-width":"100px"},{default:a(()=>[t(V,{label:"角色名称",prop:"role_name"},{default:a(()=>[t(R,{modelValue:m.role_name,"onUpdate:modelValue":e[9]||(e[9]=l=>m.role_name=l)},null,8,["modelValue"])]),_:1}),t(V,{label:"描述"},{default:a(()=>[t(R,{modelValue:m.description,"onUpdate:modelValue":e[10]||(e[10]=l=>m.description=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),Se=ve(We,[["__scopeId","data-v-8e77bbe6"]]);export{Se as default};
