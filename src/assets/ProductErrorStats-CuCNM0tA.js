import{s as z}from"./statisticsApi-DMMUHzRw.js";import{i as x}from"./index-u3wYLQ4o.js";import{d as B,r as c,c as M,p as L,q as O,b as l,e,s as V,f as g,g as y,v as j,x as k,w as m,F as E,B as D,t as i,Z as I,m as P,o,$}from"./index-CCQ4VAXS.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"product-error-stats-container"},R={class:"page-header"},U={class:"date-selector"},W={class:"card-header"},q={key:0,class:"no-data"},A={key:1,class:"product-list"},T={class:"card-header"},Z={class:"product-stats"},G={class:"stat-item"},H={class:"stat-value primary"},J={class:"stat-item"},K={class:"stat-value success"},Q={class:"stat-item"},X={class:"stat-value warning"},ee={class:"stat-item"},te={class:"stat-value danger"},se={class:"error-types"},ae={key:0,class:"no-errors"},oe={key:1,class:"error-chart"},re=["id"],le={class:"error-list"},ie={class:"error-name"},ne={class:"error-count"},ce=B({__name:"ProductErrorStats",setup(de){const d=c(!0),v=c([]),f=c(""),n=c({}),u=c(""),C=M(()=>f.value?f.value:"今日"),b=async()=>{d.value=!0;try{const s=u.value?{date:u.value}:{},t=await z.getProductErrorStatistics(s);v.value=t.products,f.value=t.date,await I(),S()}catch(s){console.error("获取产品异常统计数据失败:",s),P.error("获取产品异常统计数据失败")}finally{d.value=!1}},S=()=>{Object.values(n.value).forEach(s=>s.dispose()),n.value={},v.value.forEach(s=>{if(s.error_types.length===0)return;const t=document.getElementById(`error-chart-${s.product}`);if(!t)return;const _=x(t);n.value[s.product]=_;const h={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:s.error_types.map(r=>r.error_code)},series:[{name:"异常原因",type:"pie",radius:["45%","75%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:s.error_types.map(r=>({value:r.count,name:r.error_code,itemStyle:{color:r.color}}))}]};_.setOption(h)})},w=()=>{Object.values(n.value).forEach(s=>s.resize())};return L(()=>{b(),window.addEventListener("resize",w)}),O(()=>{window.removeEventListener("resize",w),Object.values(n.value).forEach(s=>s.dispose()),n.value={}}),(s,t)=>{const _=y("el-date-picker"),h=y("el-empty"),r=y("el-card"),Y=j("loading");return o(),l("div",N,[e("div",R,[t[1]||(t[1]=e("div",{class:"header-content"},[e("h1",{class:"page-title"},"产品异常统计"),e("p",{class:"page-description"},"查看各产品异常类型分布和统计数据")],-1)),e("div",U,[g(_,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:!1,onChange:b},null,8,["modelValue"])])]),V((o(),k(r,{class:"summary-card",shadow:"hover"},{header:m(()=>[e("div",W,[e("h3",null,i(C.value)+" 产品异常统计",1)])]),default:m(()=>[!d.value&&v.value.length===0?(o(),l("div",q,[g(h,{description:"暂无数据"})])):(o(),l("div",A,[(o(!0),l(E,null,D(v.value,a=>(o(),k(r,{key:a.product,class:"product-card",shadow:"hover"},{header:m(()=>[e("div",T,[e("h3",null,i(a.product),1)])]),default:m(()=>[e("div",Z,[e("div",G,[t[2]||(t[2]=e("div",{class:"stat-label"},"总检测数",-1)),e("div",H,i(a.total),1)]),e("div",J,[t[3]||(t[3]=e("div",{class:"stat-label"},"正常数量",-1)),e("div",K,i(a.ok_count),1)]),e("div",Q,[t[4]||(t[4]=e("div",{class:"stat-label"},"异常数量",-1)),e("div",X,i(a.ng_count),1)]),e("div",ee,[t[5]||(t[5]=e("div",{class:"stat-label"},"异常率",-1)),e("div",te,i(a.ng_rate)+"%",1)])]),e("div",se,[t[6]||(t[6]=e("h4",{class:"section-title"},"异常原因分布",-1)),a.error_types.length===0?(o(),l("div",ae,[g(h,{description:"暂无异常数据","image-size":100})])):(o(),l("div",oe,[e("div",{ref_for:!0,ref:"errorCharts",id:`error-chart-${a.product}`,class:"chart-container"},null,8,re),e("div",le,[(o(!0),l(E,null,D(a.error_types,p=>(o(),l("div",{key:p.error_code,class:"error-item"},[e("div",{class:"error-color",style:$({backgroundColor:p.color})},null,4),e("div",ie,i(p.error_code),1),e("div",ne,i(p.count),1)]))),128))])]))])]),_:2},1024))),128))]))]),_:1})),[[Y,d.value]])])}}}),pe=F(ce,[["__scopeId","data-v-e495c7a1"]]);export{pe as default};
