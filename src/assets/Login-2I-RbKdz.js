import{d as k,r as w,a as N,c as S,b as A,e as l,f as r,_ as E,w as i,g as d,u as v,h as C,l as F,i as I,j as L,t as R,A as B,E as q,k as D,m as y,o as J}from"./index-CCQ4VAXS.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"login-container"},U={class:"login-box"},Y={class:"login-footer"},j=k({__name:"Login",setup(M){const p=D(),m=w(),s=N({username:"",password:""}),h={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},c=w(!1),x=S(()=>new Date().getFullYear()),f=async()=>{m.value&&await m.value.validate(async(g,e)=>{var n,t;if(g){c.value=!0;try{const a=await B.login({username:s.username,password:s.password});console.log("登录响应:",a);const{token:u,user:o}=a;if(u&&o){localStorage.setItem("token",u),localStorage.setItem("user",JSON.stringify(o)),q({title:"登录成功",message:`欢迎回来，${o.username}`,type:"success",duration:2e3});const _=o.roles.some(b=>b.role_name==="admin"),V={...o,is_admin:_};localStorage.setItem("user",JSON.stringify(V)),_?p.push("/admin/configs"):p.push("/")}else throw new Error("登录失败: 无效的响应数据")}catch(a){console.error("登录失败:",a),y.error(((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"登录失败，请检查用户名和密码")}finally{c.value=!1}}else console.log("表单验证失败:",e),y.error("请正确填写登录信息")})};return(g,e)=>{const n=d("el-input"),t=d("el-form-item"),a=d("el-button"),u=d("el-form");return J(),A("div",O,[l("div",U,[e[3]||(e[3]=l("div",{class:"login-header"},[l("img",{src:E,alt:"Logo",class:"logo"}),l("h1",{class:"title"},"昌瑞视觉检测管理系统")],-1)),r(u,{ref_key:"loginFormRef",ref:m,model:s,rules:h,class:"login-form",onKeyup:L(f,["enter"])},{default:i(()=>[r(t,{prop:"username"},{default:i(()=>[r(n,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=o=>s.username=o),placeholder:"用户名","prefix-icon":v(C),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,{prop:"password"},{default:i(()=>[r(n,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=o=>s.password=o),type:"password",placeholder:"密码","prefix-icon":v(F),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),r(t,null,{default:i(()=>[r(a,{type:"primary",loading:c.value,class:"login-button",onClick:f},{default:i(()=>e[2]||(e[2]=[I(" 登录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),l("div",Y,[l("p",null,"© "+R(x.value)+" 昌瑞视觉检测管理系统",1)])])])}}}),$=K(j,[["__scopeId","data-v-29a774f7"]]);export{$ as default};
